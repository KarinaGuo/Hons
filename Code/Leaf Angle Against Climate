library(raster)
library(tidyverse)


data <- read.csv ("Data/Leaf_angles_51.csv") %>% 
  dplyr::select (Species.name, Type, Mean) 
colnames(data) = c("scientificName", "Type", "mean_Measurement")

data_ALA = read.csv  ("Data/Eucalyptus_genus_ALA_CUT.csv", header = T) %>% 
  dplyr::select (basisOfRecord, decimalLatitude, decimalLongitude, geodeticDatum, scientificName) %>%
  filter (!is.na(decimalLatitude))


r <- getData("worldclim",var="bio",res=5)
r <- r[[c(1,12,6,5,8,9)]]
names(r) <- c("Temp","Prec","Coldest","Hottest","Wettest","Driest")

coords <- data.frame(x=data_ALA[3],y=data_ALA[2])
points <- SpatialPoints(coords, proj4string = r@crs)

values <- raster::extract(r,points)
data_ALA_measurement <- cbind.data.frame(values, data_ALA) %>% 
  filter (!is.na(Temp))
data_ALA_measurement[1] <- data_ALA_measurement[1]/10
data_ALA_measurement[3] <- data_ALA_measurement[3]/10
data_ALA_measurement[4] <- data_ALA_measurement[4]/10
data_ALA_measurement[5] <- data_ALA_measurement[5]/10
data_ALA_measurement[6] <- data_ALA_measurement[6]/10


data_ALA_measurement_summary <- data_ALA_measurement %>% 
  group_by (scientificName) %>% 
  summarise (median_Temp = median(Temp), median_Prec = median(Prec), median_Coldest = median(Coldest), median_Hottest = median(Hottest), median_Wettest = median(Wettest), median_Driest = median(Driest)) %>% 
  left_join (by="scientificName", data) %>% 
  filter(!is.na(median_Temp), !is.na(Type))

p1 <- ggplot (data = data_ALA_measurement_summary, mapping = aes (x=median_Temp, y=mean_Measurement)) +
  geom_point(aes(color=Type)) +
  geom_smooth(method='lm', formula= y~x) + 
  labs (x= "Mean Annual Temperature", y = "Mean leaf angle")

p2 <- ggplot (data = data_ALA_measurement_summary, mapping = aes (x=median_Prec, y=mean_Measurement)) +
  geom_point(aes(color=Type)) +
  geom_smooth(method='lm', formula= y~x) + 
  labs (x= "Mean Annual Precipitation", y = "Mean leaf angle")

p3 <- ggplot (data = data_ALA_measurement_summary, mapping = aes (x=median_Coldest, y=mean_Measurement)) +
  geom_point(aes(color=Type)) +
  geom_smooth(method='lm', formula= y~x) + 
  labs (x= "Mean Annual Coldest", y = "Mean leaf angle")

p4 <- ggplot (data = data_ALA_measurement_summary, mapping = aes (x=median_Hottest, y=mean_Measurement)) +
  geom_point(aes(color=Type)) +
  geom_smooth(method='lm', formula= y~x) + 
  labs (x= "Mean Annual Hottest", y = "Mean leaf angle")

p5 <- ggplot (data = data_ALA_measurement_summary, mapping = aes (x=median_Wettest, y=mean_Measurement)) +
  geom_point(aes(color=Type)) +
  geom_smooth(method='lm', formula= y~x) + 
  labs (x= "Mean Annual median_Wettest", y = "Mean leaf angle")

p6 <- ggplot (data = data_ALA_measurement_summary, mapping = aes (x=median_Driest, y=mean_Measurement)) +
  geom_point(aes(color=Type)) +
  geom_smooth(method='lm', formula= y~x) + 
  labs (x= "Mean Annual median_Driest", y = "Mean leaf angle")


library(ggpubr)
ggarrange(p1,p2,p3,p4,p5,p6, 
          ncol = 2, nrow = 3,  
          common.legend = TRUE, legend = "right")
